<div class="card-title"><span aria-hidden="true">ðŸ”¬</span> Network Visualization</div>

@let data = visualizationData();
@if (data) {
  <!-- SVG neural network visualization -->
  <svg
    width="100%"
    height="300"
    viewBox="0 0 500 280"
    role="img"
    aria-label="Interactive neural network visualization"
  >
    <!-- Connections between neurons -->
    @for (conn of data.connections; track $index) {
      <line
        [attr.x1]="conn.x1"
        [attr.y1]="conn.y1"
        [attr.x2]="conn.x2"
        [attr.y2]="conn.y2"
        [attr.stroke]="conn.color"
        [attr.stroke-width]="conn.strokeWidth"
        [attr.stroke-opacity]="conn.opacity"
      />
    }

    <!-- Neurons (circles + values + labels) -->
    @for (neuron of data.neurons; track $index) {
      <!-- Neuron circle -->
      <circle
        [attr.cx]="neuron.cx"
        [attr.cy]="neuron.cy"
        [attr.r]="neuron.radius"
        [attr.fill]="neuron.fill"
        [attr.stroke]="colors.stroke"
        [attr.stroke-width]="neuron.strokeWidth"
      />
      <!-- Neuron value -->
      <text
        [attr.x]="neuron.cx"
        [attr.y]="neuron.cy + neuron.textOffsetY"
        text-anchor="middle"
        [attr.fill]="colors.stroke"
        [attr.font-size]="neuron.fontSize"
        [attr.font-weight]="neuron.fontWeight"
      >
        {{ neuron.value }}
      </text>
      <!-- Neuron label (if present) -->
      @if (neuron.label) {
        <text
          [attr.x]="neuron.labelX"
          [attr.y]="neuron.cy + 5"
          [attr.text-anchor]="neuron.labelAnchor"
          [attr.fill]="colors.label"
          [attr.font-size]="config.fontSize.label"
        >
          {{ neuron.label }}
        </text>
      }
    }

    <!-- Layer labels -->
    @for (label of data.layerLabels; track $index) {
      <text
        [attr.x]="label.x"
        [attr.y]="label.y"
        text-anchor="middle"
        [attr.fill]="colors.neutral"
        [attr.font-size]="config.fontSize.layerLabel"
      >
        {{ label.text }}
      </text>
    }
  </svg>

  <!-- Activation details for debugging -->
  <div class="activation-details">
    @for (detail of data.activationDetails; track detail.layerIndex) {
      <div>
        <strong>Layer {{ detail.layerIndex }} activations ({{ detail.functionName }}): </strong>
        {{ detail.values }}
      </div>
    }
    <div><strong>Output: </strong>{{ data.outputSummary }}</div>
  </div>
} @else {
  <!-- Empty state when no data available -->
  <svg
    width="100%"
    height="300"
    viewBox="0 0 500 280"
    role="img"
    aria-label="Neural network visualization waiting for data"
  >
    <text x="250" y="140" text-anchor="middle" [attr.fill]="colors.neutral">
      Waiting for data...
    </text>
  </svg>
}
